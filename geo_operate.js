var fs = require('fs');
var pg = require('pg');

var obj = JSON.parse(fs.readFileSync('connection.json', 'utf8'));

var conString = "postgres://"+obj.name+":"+obj.password+"@"+obj.host+":"+obj.port+"/"+obj.db;

var client = new pg.Client(conString);

client.connect();

var query = client.query("ALTER TABLE geo DROP COLUMN fileid; UPDATE geo SET stusab=lower(stusab); ALTER TABLE geo ADD geonum bigint; ALTER TABLE geo RENAME COLUMN geoid TO fullgeoid; ALTER TABLE geo ADD geoid varchar(12); ALTER TABLE geo ALTER COLUMN sumlevel TYPE smallint USING (sumlevel::smallint); update geo set geoid = state where sumlevel = 40; update geo set geoid = state || county where sumlevel = 50; update geo set geoid = state || county || tract where sumlevel = 140; update geo set geoid = state || county || tract || blkgrp where sumlevel = 150; update geo set geoid = state || place where sumlevel=160; update geo set geoid = state || county || cousub where sumlevel = 60; update geo set geoid = '00' || zcta5 where sumlevel = 860; update geo set geoid = state || '1' || sdelm where sumlevel = 950; update geo set geoid = state || '2' || sdsec where sumlevel = 960; update geo set geoid = state || '3' || sduni where sumlevel = 970; update geo set geoid = '0' where sumlevel = 10; update geo set geoid = state || place || county where sumlevel = 155; update geo set geoid = state || anrc where sumlevel = 230; update geo set geoid = aianhh where sumlevel = 250; update geo set geoid = state || aianhh where sumlevel = 280; update geo set geoid = cbsa where sumlevel = 310; update geo set geoid = state || cbsa where sumlevel = 320; update geo set geoid = csa where sumlevel = 330; update geo set geoid = state || csa where sumlevel = 340; update geo set geoid = necta where sumlevel = 350; update geo set geoid = state || necta where sumlevel = 360; update geo set geonum = ('1' || geoid)::bigint where sumlevel = 40; update geo set geonum = ('1' || geoid)::bigint where sumlevel = 50; update geo set geonum = ('1' || geoid)::bigint where sumlevel = 140; update geo set geonum = ('1' || geoid)::bigint where sumlevel = 150; update geo set geonum = ('1' || geoid)::bigint where sumlevel = 160; update geo set geonum = ('2' || geoid)::bigint where sumlevel = 60; update geo set geonum = ('2' || geoid)::bigint where sumlevel = 860; update geo set geonum = ('2' || geoid)::bigint where sumlevel = 950; update geo set geonum = ('2' || geoid)::bigint where sumlevel = 960; update geo set geonum = ('2' || geoid)::bigint where sumlevel = 970; update geo set geonum = ('3' || geoid)::bigint where sumlevel = 10; update geo set geonum = ('3' || geoid)::bigint where sumlevel = 155; update geo set geonum = ('3' || geoid)::bigint where sumlevel = 230; update geo set geonum = ('3' || geoid)::bigint where sumlevel = 250; update geo set geonum = ('3' || geoid)::bigint where sumlevel = 280; update geo set geonum = ('3' || geoid)::bigint where sumlevel = 310; update geo set geonum = ('4' || geoid)::bigint where sumlevel = 320; update geo set geonum = ('4' || geoid)::bigint where sumlevel = 330; update geo set geonum = ('4' || geoid)::bigint where sumlevel = 340; update geo set geonum = ('5' || geoid)::bigint where sumlevel = 350; update geo set geonum = ('5' || geoid)::bigint where sumlevel = 360; delete from geo where component <> '00'; delete from geo where sumlevel<>10 and sumlevel<>40 and sumlevel<>50 and sumlevel<>60 and sumlevel<>140 and sumlevel<>150 and sumlevel<>155 and sumlevel<>160 and sumlevel<>230 and sumlevel<>250 and sumlevel<>280 and sumlevel<>310 and sumlevel<>320 and sumlevel<>330 and sumlevel<>340 and sumlevel<>350 and sumlevel<>360 and sumlevel<>860 and sumlevel<>950 and sumlevel<>960 and sumlevel<>970;"); 

query.on('end', function() { client.end(); });